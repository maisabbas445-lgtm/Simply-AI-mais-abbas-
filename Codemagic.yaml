workflows:
  expo-android-apk:
    name: Build Expo Android APK
    environment:
      node: 18.17.0  # Ø¥ØµØ¯Ø§Ø± Node.js Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù€ Expo
      npm: 9.6.7
    scripts:
      - name: Check project structure
        script: |
          echo "ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:"
          ls -la
          echo ""
          echo "ğŸ“¦ package.json:"
          cat package.json
          echo ""
          echo "ğŸ“± app.json:"
          cat app.json
      
      - name: Install dependencies
        script: |
          echo "ğŸ“¥ ØªØ«Ø¨ÙŠØª Expo CLI Ùˆ EAS CLI..."
          npm install -g expo-cli@latest eas-cli@latest
          echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª CLI"
          
          echo "ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø­Ø²Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹..."
          npm ci --legacy-peer-deps
          echo "âœ… ØªÙ… ØªØ«Ø¨ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø²Ù…"
      
      - name: Setup Android
        script: |
          echo "ğŸ¤– Ø¥Ø¹Ø¯Ø§Ø¯ Android..."
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Android Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
          if [ ! -d "android" ]; then
            echo "ğŸ”¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯Ø§Øª Android..."
            npx expo prebuild --platform android
          fi
          
          # Ù†Ø³Ø® Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
          if [ -f ".env.example" ] && [ ! -f ".env" ]; then
            cp .env.example .env
            echo "ğŸ“„ ØªÙ… Ù†Ø³Ø® Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ¦Ø©"
          fi
      
      - name: Build Android APK (Development)
        script: |
          echo "ğŸ”¨ Ø¨Ù†Ø§Ø¡ APK Ù„Ù„ØªÙ†Ù…ÙŠØ©..."
          cd android
          ./gradlew assembleDebug
          echo "âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ APK Ù„Ù„ØªÙ†Ù…ÙŠØ©"
      
      - name: Build Android APK (Release)
        script: |
          echo "ğŸš€ Ø¨Ù†Ø§Ø¡ APK Ù„Ù„Ø¥ØµØ¯Ø§Ø±..."
          cd android
          ./gradlew assembleRelease
          echo "ğŸ‰ ØªÙ… Ø¨Ù†Ø§Ø¡ APK Ù„Ù„Ø¥ØµØ¯Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!"
          
          # Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
          APK_PATH="app/build/outputs/apk/release/app-release.apk"
          if [ -f "$APK_PATH" ]; then
            echo "ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª APK:"
            ls -lh "$APK_PATH"
            echo "ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø±: $APK_PATH"
          else
            echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ APKØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«..."
            find . -name "*.apk" -type f
          fi
      
      - name: Create download instructions
        script: |
          echo "â¬‡ï¸ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„:" > download_instructions.txt
          echo "1. Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Artifacts" >> download_instructions.txt
          echo "2. Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù app-release.apk" >> download_instructions.txt
          echo "3. Ø­Ù…Ù„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ" >> download_instructions.txt
          echo "4. Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Android Ù„Ù„ØªØ«Ø¨ÙŠØª" >> download_instructions.txt
          echo "" >> download_instructions.txt
          echo "ğŸ“§ Ø³ÙŠØµÙ„Ùƒ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù„Ù‰: maisabbas445@gmail.com" >> download_instructions.txt
    
    artifacts:
      - android/app/build/outputs/apk/debug/*.apk
      - android/app/build/outputs/apk/release/*.apk
      - download_instructions.txt
      - build/**/*.apk
      - *.apk
    
    publishing:
      email:
        recipients:
          - maisabbas445@gmail.com
        notify:
          success: true
          failure: true
        subject: "âœ… Ø¨Ù†Ø§Ø¡ Simply AI ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!"
        body: |
          ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Simply AI Ø¨Ù†Ø¬Ø§Ø­!
          
          ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ APK Ù…Ù†:
          1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Codemagic
          2. Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ø®ÙŠØ±
          3. Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªabÙˆÙŠØ¨ "Artifacts"
          4. ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù app-release.apk
          
          Ø£Ùˆ Ø§Ù†ØªØ¸Ø± Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ³ÙŠØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø£Ø®Ø±Ù‰.
      
      scripts:
        - name: Generate direct link
          script: |
            echo "ğŸ”— Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±..."
          only_if: "build.status == 'success'"

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
project_directory: .  # Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
app_id: com.maisabbas.simplyai  # ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡

# Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
cache:
  cache_paths:
    - ~/.npm
    - ~/.expo
    - node_modules
    - android/.gradle

# Ù…ØªÙ‰ ÙŠØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡
triggering:
  events:
    - push
  branch_patterns:
    - pattern: 'main'
      include: true
      source: true
    - pattern: 'develop'
      include: true
      source: true
  cancel_previous_builds: true

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¸Ø§Ù‡Ø±ÙŠ
instance_type: mac_mini_m2  # Ù„Ø¨Ù†Ø§Ø¡ Ø£Ø³Ø±Ø¹
