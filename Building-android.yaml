workflows:
  simply-ai-android:
    name: ุจูุงุก Simply AI
    description: ุจูุงุก APK ูุชุทุจูู Simply AI ูุน Expo
    
    environment:
      node: 18.19.0  # ูุชูุงูู ูุน Expo 50
      npm: 10.2.3
    
    scripts:
      # ุงููุฑุญูุฉ 1: ุงูุฅุนุฏุงุฏ ูุงูุชุซุจูุช
      - name: ุฅุนุฏุงุฏ ุงูุจูุฆุฉ
        script: |
          echo "๐ ุจุฏุก ุจูุงุก Simply AI v3.0.0"
          echo "๐ฑ Expo 50 | React Native 0.73"
          echo "โฐ ุงูููุช: $(date)"
          pwd
          ls -la
      
      - name: ุชุซุจูุช ุงูุญุฒู
        script: |
          echo "๐ฆ ุชุซุจูุช ุญุฒู ุงููุดุฑูุน..."
          npm install --legacy-peer-deps
          echo "โ ุชู ุงูุชุซุจูุช ุจูุฌุงุญ"
          
          # ุชุซุจูุช EAS CLI ููุจูุงุก
          npm install -g eas-cli@latest
      
      # ุงููุฑุญูุฉ 2: ุงูุจูุงุก
      - name: ุจูุงุก APK
        script: |
          echo "๐จ ุฌุงุฑู ุจูุงุก APK..."
          
          # ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู EAS Build (ุงูุฃูุถู)
          echo "๐ ูุญุงููุฉ ุงูุจูุงุก ุนุจุฑ EAS..."
          
          # ุฅุฐุง ูุงู ููุงู ุชูููุ ุงุณุชุฎุฏู EAS
          if [ -n "$EXPO_TOKEN" ]; then
            echo "๐ ุงูุจูุงุก ุจุงุณุชุฎุฏุงู EAS Token..."
            eas build --platform android --profile preview --non-interactive
          else
            # ุงูุทุฑููุฉ 2: ุงูุจูุงุก ุงููุจุงุดุฑ
            echo "โ๏ธ ุงูุจูุงุก ุงููุจุงุดุฑ..."
            npx expo prebuild --platform android --clean
            cd android
            chmod +x gradlew
            ./gradlew assembleDebug
            echo "โ ุชู ุงูุจูุงุก ุงููุจุงุดุฑ"
          fi
      
      # ุงููุฑุญูุฉ 3: ุงูุชุญุถูุฑ ูููุดุฑ
      - name: ุฅุนุฏุงุฏ ุงููุดุฑ
        script: |
          echo "๐ค ุชุฌููุฒ ุงููููุงุช ูููุดุฑ..."
          
          # ุงูุจุญุซ ุนู ููู APK
          if [ -f "android/app/build/outputs/apk/debug/app-debug.apk" ]; then
            APK_PATH="android/app/build/outputs/apk/debug/app-debug.apk"
          elif [ -f "app-debug.apk" ]; then
            APK_PATH="app-debug.apk"
          else
            # ุงูุจุญุซ ูู ุฃู ููุงู
            APK_PATH=$(find . -name "*.apk" -type f | head -1)
          fi
          
          if [ -n "$APK_PATH" ] && [ -f "$APK_PATH" ]; then
            echo "๐ฏ ุชู ุงูุนุซูุฑ ุนูู APK: $APK_PATH"
            echo "๐ ุญุฌู ุงูููู: $(du -h "$APK_PATH" | cut -f1)"
          else
            echo "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู APK"
          fi
    
    # ุงููููุงุช ุงููุงุชุฌุฉ
    artifacts:
      - android/app/build/outputs/apk/debug/*.apk
      - android/app/build/outputs/apk/debug/app-debug.apk
      - build-*.apk
      - *.apk
    
    # ุฅุนุฏุงุฏุงุช ุงููุดุฑ
    publishing:
      # ุฅุฑุณุงู ุฅูููู
      email:
        recipients:
          - maisabbas445@gmail.com
        notify:
          success: true
          failure: true
        subject: "โ Simply AI Build ${CM_BUILD_NUMBER}"
        body: |
          ุชู ุจูุงุก ุชุทุจูู Simply AI ุจูุฌุงุญ!
          
          ุงูุฅุตุฏุงุฑ: 3.0.0
          Expo: 50.0.0
          React Native: 0.73.0
          
          ุฑุงุจุท ุงูุชุญููู: ${CM_ARTIFACT_LINKS}
          
          ุฃู ููููู:
          1. ุชุณุฌูู ุงูุฏุฎูู ุฅูู Codemagic
          2. ุงูุฐูุงุจ ุฅูู Builds
          3. ุงุฎุชูุงุฑ ูุฐุง ุงูุจูุงุก
          4. ุงูุถุบุท ุนูู Artifacts
          5. ุชุญููู ุงูููู
      
      # ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ุงุฎุชูุงุฑู)
      environment:
        groups:
          - expo_variables  # ููููู ุฅูุดุงุก ูุฐู ุงููุฌููุนุฉ ูุงุญูุงู

# ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู
app_id: com.maisabbas.simplyai
instance_type: mac_mini_m2  # ูุจูุงุก ุฃุณุฑุน

# ูุชู ูุชู ุงูุจูุงุก
triggering:
  events:
    - push
    - pull_request
  branch_patterns:
    - pattern: 'main'
      include: true
      source: true
    - pattern: 'develop'
      include: true
      source: true

# ุงูุชุฎุฒูู ุงููุคูุช ูุชุณุฑูุน ุงูุจูุงุก ุงููุงุฏู
cache:
  cache_paths:
    - ~/.npm
    - ~/.expo
    - node_modules
    - android/.gradle
