workflows:
  android-production:
    name: ุจูุงุก Simply AI ููุฅูุชุงุฌ
    description: ุจูุงุก APK ููุงุฆู ูุชุทุจูู Simply AI
    
    environment:
      node: 18.19.0
      npm: 10.2.3
    
    scripts:
      # ุงููุฑุญูุฉ 1: ุงูุฅุนุฏุงุฏ
      - name: ุฅุนุฏุงุฏ ุงููุดุฑูุน
        script: |
          echo "๐ฏ ุจุฏุก ุจูุงุก Simply AI ุงูุฅุตุฏุงุฑ 3.0.0"
          echo "๐ ุงูุชุงุฑูุฎ: $(date)"
          echo "๐ ุงููููุน: $(pwd)"
          ls -la
      
      # ุงููุฑุญูุฉ 2: ุชุซุจูุช ุงูุญุฒู
      - name: ุชุซุจูุช ุงูุชุจุนูุงุช
        script: |
          echo "๐ฆ ุฌุงุฑู ุชุซุจูุช ุงูุญุฒู..."
          npm install --legacy-peer-deps
          echo "โ ุชู ุชุซุจูุช ุฌููุน ุงูุญุฒู"
          
          # ุชุซุจูุช Expo CLI ุฅุฐุง ูุฒู
          npm install -g expo-cli@latest
      
      # ุงููุฑุญูุฉ 3: ุจูุงุก Android
      - name: ุจูุงุก APK
        script: |
          echo "๐จ ุฌุงุฑู ุจูุงุก APK..."
          
          # ุฅูุดุงุก ูุฌูุฏุงุช Android (ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ)
          npx expo prebuild --platform android --clean
          
          # ุงูุงูุชูุงู ุฅูู ูุฌูุฏ Android ูุงูุจูุงุก
          cd android
          
          # ููุญ ุตูุงุญูุงุช ูููู gradlew
          chmod +x gradlew
          
          # ุจูุงุก APK ููุชุตุญูุญ
          ./gradlew assembleDebug
          
          echo "โ ุชู ุจูุงุก APK ููุชุตุญูุญ"
          
          # ูุญุงููุฉ ุจูุงุก ุฅุตุฏุงุฑ (ุงุฎุชูุงุฑู)
          echo "โก ูุญุงููุฉ ุจูุงุก ุฅุตุฏุงุฑ..."
          ./gradlew assembleRelease || echo "โ๏ธ ุจูุงุก ุงูุฅุตุงุฎุฏูุฑ ูุญุชุงุฌ ุชูููุน"
      
      # ุงููุฑุญูุฉ 4: ุงูุชุญุถูุฑ ุงูููุงุฆู
      - name: ุงูุชุญุถูุฑ ููุชูุฒูุน
        script: |
          echo "๐ ุฌูุน ุงููุนูููุงุช..."
          
          # ุงูุจุญุซ ุนู ููู APK
          APK_PATH=""
          
          if [ -f "android/app/build/outputs/apk/debug/app-debug.apk" ]; then
            APK_PATH="android/app/build/outputs/apk/debug/app-debug.apk"
          elif [ -f "app/build/outputs/apk/debug/app-debug.apk" ]; then
            APK_PATH="app/build/outputs/apk/debug/app-debug.apk"
          else
            # ุจุญุซ ุดุงูู
            APK_PATH=$(find . -name "*.apk" -type f | head -1)
          fi
          
          if [ -n "$APK_PATH" ] && [ -f "$APK_PATH" ]; then
            echo "๐ฏ ุชู ุงูุนุซูุฑ ุนูู APK: $APK_PATH"
            echo "๐ฆ ุงูุญุฌู: $(du -h "$APK_PATH" | cut -f1)"
            echo "๐ ุงููุณุงุฑ ุงูููุงุฆู: $APK_PATH"
          else
            echo "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู APKุ ูุงุฆูุฉ ุงููููุงุช:"
            find . -name "*.apk" -type f
          fi
          
          echo "๐ ุนูููุฉ ุงูุจูุงุก ุงูุชููุช!"
    
    # ุงููููุงุช ุงููุงุชุฌุฉ
    artifacts:
      - android/app/build/outputs/apk/debug/*.apk
      - android/app/build/outputs/apk/debug/app-debug.apk
      - app/build/outputs/apk/debug/*.apk
      - build/**/*.apk
      - "**/*.apk"
    
    # ุฅุนุฏุงุฏุงุช ุงููุดุฑ
    publishing:
      email:
        recipients:
          - maisabbas445@gmail.com
        notify:
          success: true
          failure: true
        subject: "๐ Simply AI APK ุฌุงูุฒุฉ - ${CM_BUILD_NUMBER}"
        body: |
          โ ุชู ุจูุงุก ุชุทุจูู Simply AI ุจูุฌุงุญ!
          
          ๐ ูุนูููุงุช ุงูุจูุงุก:
          - ุงูุฅุตุฏุงุฑ: 3.0.0
          - Expo: 50.0.0
          - React Native: 0.73.0
          - ููุช ุงูุจูุงุก: ${CM_BUILD_CREATED_AT}
          
          ๐ฅ ุงูุชุญููู:
          ููููู ุชุญููู APK ูู ูุณู Artifacts ูู Codemagicุ ุฃู ุงุณุชุฎุฏุงู ุงูุฑุงุจุท:
          ${CM_ARTIFACT_LINKS}
          
          โก ุชุนูููุงุช ุณุฑูุนุฉ:
          1. ุงุฏุฎู ุฅูู Codemagic
          2. ุงุถุบุท ุนูู ูุฐุง ุงูุจูุงุก
          3. ุงุฎุชุฑ ุนูุงูุฉ ุงูุชุจููุจ Artifacts
          4. ุญูู ููู app-debug.apk
      
      # (ุงุฎุชูุงุฑู) ููููู ุฅุถุงูุฉ Slack/Telegram ูุงุญูุงู

# ุฅุนุฏุงุฏุงุช ุฅุถุงููุฉ
app_id: com.maisabbas.simplyai
instance_type: mac_mini_m2  # ูุจูุงุก ุฃุณุฑุน

# ูุญูุฒุงุช ุงูุจูุงุก
triggering:
  events:
    - push
  branch_patterns:
    - pattern: '*'
      include: true
  cancel_previous_builds: false

# ุงูุชุฎุฒูู ุงููุคูุช
cache:
  cache_paths:
    - ~/.npm
    - node_modules
    - android/.gradle
